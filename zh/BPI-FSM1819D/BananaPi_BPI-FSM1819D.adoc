= 介绍

BPI-FSM8191D伺服电机控制器是香蕉派开源社区和Fortior技术共同打造的工业级伺服电机控制产品。它是一个伺服模块，用于驱动旋转伺服电机，直线伺服电机和力矩电机。在实际应用中，它由主控板和电源板组成，提供电机控制核心算法和各种通信功能。BPI-FSM8191D伺服模块主控板，配置有两个应用端口和一个电源板接口，伺服模块引脚包含多个信号接口，可以满足大部分伺服功能的调试。在不同的应用场景下，伺服电源板可以定制提供电源输入输出、电源和能耗需求。电源板具有丰富的调试接口，充分满足开发人员对不同电源和电源的需求。

= 应用方向

- 新能源产业：模切机、覆膜机、分切覆膜机、极耳焊接机、涂层机、外壳机、顶焊、氦气检测仪、注液机、成型柜、补料机、封焊机、分型柜、包装线等。
- 半导体行业：清洗设备、光刻机、蚀刻机、修复测试设备、划片机、晶圆探针测试设备、分选机、贴片机、邦定机等设备
- 新型显示产业：固晶机、返修机、点胶机、贴合设备、邦定设备、背光组装设备、贴片设备、切割设备、AOI设备等基础成套工艺设备。
- 光学行业：焊接机、调焦机、摆光机、装配机、成像检测等。


= 硬件

image::/picture/bpi-fsm1819d_board.jpg[bpi-fsm1819d_board.jpg]

= 硬件规格
== 常用伺服控制器电气规格模块组成

[options="header",cols="2,3,1"]
|====
3+| 伺服控制器电气规格
| Number | spec |              
.3+| 电源电路输入电源（L1,L2,L3）  | 额定电压（VAC line-line）±10%   | 240         
                                | 频率(Hz)  | 50 
                                 | 240VAC         | 单相/三相
| 控制电路输入电源（L1C,L2C） | 240±10VAC | 单相
| 逻辑输入保险丝（延时）   | 240VAC(A)    | 0.5          
| STO (安全扭矩切断) | STP DC(VDC)  | 24±10%       
| STO 保险丝 (延时)          | 240VAC(A)    | 1.5          
.5+| 电机输出 (U,V,W)  | 连续输出电源 (Arms)| 4.5                                                     | 连续输出电源 （Apeak）  | 6.63          
                      | 2秒内的峰值输出电流（Arms）  | 14              
                      | 2秒内的峰值输出电流（Apeak） | 20           
                      | PWM 频率（kHz）                      | 16   
.2+| Soft boot              | 最大浪涌电流（A）| 7            
                            | 最大充电时间(ms) | 250                
.2+| 跳闸电压     | 欠压跳闸（额定）(VDC)| 50                                                    | 过电压跳闸(VDC) | 420             
| 超温 | 电源板过热指示故障温度（稳定温度）（℃） | 100±5%       
.3+| 再生制动 | 内部母线电容（uF）    |
             |VLOW（再生电路关闭）（VDC）|380 (can set)
             |VMAX（再生电路开启）（VDC）	|400 (can set)
|====

== 伺服模块控制规格

[options="header",cols="1,2,3"]
|====
3+|接口选项：模拟电压/脉冲指令/RS232控制规格
|Item	|spec	|explain
.2+|电机	|Ac and DC	 |旋转伺服电机、直线伺服电机
          |自动配置 |自动配置电机相位和相线设置
|运行模式	|可选择模式	|转矩控制、速度控制、位置控制
.6+|转矩控制	|输入指令/输出指令	|速度命令/PCOC
                    |性能	|刷新率 rate62.5us (16kHz)
                    |阶跃响应时间	|
                    |控制方式	|DQ, PI
                    |参考命令	|simulate±10VDC，serial RS232
                    |自动调节	|手动调整当前循环参数
.5+|速度控制	|输入指令/输出指令	|速度命令 / PCOC
                  |性能	|刷新率: 125 μs (8 kHz)
                  |可选速度控制方法	|PI
                  |滤波器 | 一阶低通滤波器，两个级联的一阶低滤波器
                  |参考命令	|simulation±10 VDC, serial RS232 or USB
.4+|位置控制	|输入指令/输出指令	|位置指令/速度指令
             |性能	|刷新率:250us（4kHz）
             |控制方式	|PID和加速度前馈
             |参考命令|Pulse & direction with electronic drive，serial ，serial RS232
|状态显示 |形式	|Fase 7 LED（红色），显示驱动器状态（报警、运行、启用等）
|电子齿轮	|方法|用户定义的齿轮比
.2+|GUI	|UI	|基于Windows串口软件
        |功能	|设置连接、驱动器信息、电源信息、电机、反馈、I/O选择/配置、运动设置/调整、故障历史/状态显示等。
.3+|向单位旋转	|位置	|（Counts）
                        |速度|每分钟（rpm）
                        |加速/减速	|rps/s
.3+|线单元	|位置	|（Counts）、mm
              |速度	|mm/s
              |加速/减速	|mm/s2
|====

== Servo module communication specifications
[options="header",cols="2,3",width="70%"]
|====
2+|Communication specification
|number	|spec
.3+|RS232	|base on modbus RTU
          |Baud rate: 19200 bit/s
          |Maximum conductor length: 10 m
.3+|High-Speed Serial (Specially used to observe waveforms)	|Based on custom protocols
                                                            |Baud rate: 115200 - 750000 bit/s
                                                            |Maximum conductor length:2 m
|====


== Servo module I/O specifications

[options="header",cols="2,2,3"]
|====
3+|Servo module I/O specifications
|Item	|standard	|explain
.3+|analog input	|voltage range	    |simulate ±10 VDC Finite difference
                  |zero attenuation	  |100 Hz
                  |bandwidth (-3 dB) 	|500 Hz
.2+|Pulse & Direction	|signal|RS 422 line receiver
                      |Maximum input frequency	|1.6 MHz (will be increased to 5MHz in the future)
|Digital input (8 channels)	|signal	|Configurable, light isolated, drain input.
.3+|(General IO configurable related pin function)|voltage	|24 V
                                                  |Maximum input current |10 mA
                                                  |Transfer delay time	 |1 ms
|Digital output (6 channels)	|signal	|Configurable, light isolated, drain input.
.3+|(General IO configurable related pin function)	|voltage	|24 V
                                                    |Maximum input current	|40 mA
                                                    |Transfer delay time	|1 ms
|Main I/O function signal	|function	|explain
.6+|input signal（Ports can be configured）	|forward limit	|Positive limit switch
                                           |Negative limit	|Negative limit switch
                                           |Return Origin	|Origin switch
                                           |Motor enable	|External enable signal
                                           |ALM-RST	|External clear alarm signal
                                           |speed limitation	|Torque control with speed limit input
.6+|Output signal (port configurable)	|Servo positioning complete	|Servo execution positioning complete signal
                                      |SERVO stoped	|Servo execution stop signal
                                      |SERVO ALARM	|Servo error alarm signal
                                      |Servo brake	|Servo brake control signal
                                      |Servo phase seeking complete	|Servo phase seeking complete signal
                                      |Servo return to zero complete	|Servo return to zero complete signal
|====

== Servo module supports motor feedback specifications

[options="header",cols="2,2,3"]
|====
3+|Supported motor feedback specifications
|motor feedback	|specifications	|explain
.3+|summary	|Driver output voltage	|5 VDC
            |Maximum output current of the driver	|250 mA
            |Maximum cable length	|AWG 28 – 3 m； AWG 24 – 10 m
.3+|incremental encoder|	signal	|With (or without) a zero/hall signal AB quadrature signal encoder differential output
                       |AB Orthogonal maximum input frequency	|1.6 MHz (Orthogonality conditions) (It will be increased to 5MHz in the future)
                       |Minimum zero pulse width	|1 µs
                       |Hall sensor	|signal	|single-ended
.6+|Sinusoidal encoder (will be added in next version)	|signal	|Sine-cosine difference, with or without Hall
                                                        |signal level	|1 Vpp @ 2.5 V
                                                        |Maximum input frequency	|270 kHz
                                                        |input impedance	|120 Ω
                                                        |interpolation	|Max to 16384 (14 bit)
                                                        |Effective interpolation	|Max to 4096 (12 bit)
|====

== Motor signal feedback wire pin definition
The motor feedback interface is wired according to the type of feedback device used in practical applications. See the pin outlet table below for details.

The motor temperature sensor uses 12/25 pins and has been pulled up to 5V through the module interior.

[options="header",cols="1,1,2,1,1,2"]
|====
6+|Motor signal feedback wire pin definition
|Pin define	|Module pin	|function	|Pin define	|Module pin	|function
|1	|97	a|- incremental encoder A+
- SSI encoder data+|14	|98	|incremental encoder A-
|2	|96	a|- incremental encoder B+	
- SSI encoder clock+|15	|95	a|- incremental encoder B-
- SSI encoder clock-
|3	|93	|incremental encoder Z+	|16	|94	|incremental encoder Z-
|4	|116	|Hall U+	|17	|115	|Hall V+
|5	|114	|Hall W+	|18	| /	|/
|6	|/	|/	|19	|/	|/
|7	|/	|/	|20	|/	|/
|8	|/	|/	|21	|/	|/
|9	|111	|Sine encoder sine+	|22	|110	|Sine encoder sine-
|10	|109	|Sine encoder cosine+	|23	|108	|Sine encoder cosine-
|11	|3、4	|5V power	|24	|Common ground with module	|ground（5V loop）
|12	|91	|Motor temperature sensor	|25	|90	|Motor temperature sensor
|13	|3、4	|5V power	|26	|/	|shield
|====

== Servo module I/O port pin definition
The digital/analog inputs and outputs are wired according to the requirements of your application. To keep the digital I/O isolated, the ground of your 24V loop is connected to pins 1 and 19, which drive the digital input pins and require you to provide a 24V signal.

[options="header",cols="1,2,3,3"]
|====
4+|Servo module I/O port pin definition
| Pin define | Module pin | function | explain                               | 1  | 64                        | Digital input to the public ground  | user provides a 24V input signa ground 
| 2  | 107                       | Equivalent encoder output Z+        | Equivalent encoder output signal Z forward direction       
| 3  | /                         | /                                   |
| 4  | 106                       | Equivalent encoder output Z-        | Equivalent encoder output signal Z negative                
| 5  | 104                       | Equivalent encoder output B+        | Equivalent encoder output signal B forward direction       
| 6  | /                         | /                                   |
| 7  | 105                       | Equivalent encoder output B-        | Equivalent encoder output signal B negative                
| 8  | 112                       | Analog input AN+                    | Diff forward direction of analog instruction input         
| 9  | 103                       | Equivalent encoder output A-        | Equivalent encoder output signal A negative                
| 10 | Common ground with module | DGND                                | DGND                                                       
| 11 | 102                       | Equivalent encoder output A+        | Equivalent encoder output signal A forward direction       
| 12 | 113                       | Analog input AN-                    | Differential analog instruction input in negative direction
| 13 | Common ground with module | DGND                                | DGND                                                       
| 14 | 87                        | direction input -                   | Direction Indicates the negative direction of the input    
| 15 | 79                        | Digital input 2                     | Optically isolated programmable digital input，Read with IN2
| 16 | 86                        | direction input +                   | Direction Indicates the positive direction of the input    
| 17 | 89                        | impulse input +                     | The pulse input is positive                                
| 18 | 88                        | impulse input -                     | The negative direction of the pulse input                  
| 19 | 72                        | Digital output to the public ground | provides 24V pull-up ground                                          
| 20 | 84                        | RS485 ommunication input -          | RS485 ommunication input -(Or B terminal)                            
| 21 | 83                        | 485 input +                         | RS485 communication input +(Or A terminal)                           
| 22 | 73                        | Digital input 8                     | Optically isolated programmable digital input 8                      
| 23 | 74                        | Digital input 7                     | Optically isolated programmable digital input 7                      
| 24 | 75                        | Digital input 6                     | Optically isolated programmable digital input 6                      
| 25 | Common ground with module | DGND                                | DGND                                                                 
| 26 | 76                        | Digital input 5                     | Optically isolated programmable digital input 5                      
| 27 | 77                        | Digital input 4                     | Optically isolated programmable digital input 4                      
| 28 | 78                        | Digital input 3                     | Optically isolated programmable digital input 3                      
| 29 | Common ground with module | DGND                                | DGND                                                                 
| 30 | 68                        | Digital output 3                    | Optically isolated programmable digital output， can be read with OUT3
| 31 | 65                        | Digital output 6                    | Optically isolated programmable digital output， can be read with OUT6
| 32 | 69                        | Digital output 2                    | Optically isolated programmable digital output， can be read with OUT2
| 33 | 80                        | Digital input 1                     | Optically isolated programmable digital input，Read with IN1          
| 34 | 70                        | Digital output 1                    | Optically isolated programmable digital output， can be read with OUT1
| 35 | 66                        | Digital output 5                    | Optically isolated programmable digital output， can be read with OUT5
| 36 | 67                        | Digital output 4                    | Optically isolated programmable digital output， can be read with OUT4
|====

== Servo module protection function and use environment requirements
[options="header",cols="2,5",width="70%"]
|====
2+|Servo module protection function and use environment requirements
|item	 |spec
|Protection function	|Overcurrent, undervoltage and overvoltage, overtemperature, missing feedback, STO signal not connected, position following error, speed over, parameter error, etc.
|Anti-flying car protection function	|When the motor is seeking phase, the external pulse input signal function (pulse & direction) and the receiving motion command function (RS232) are shielded to prevent motor accidents.
|====

= Development
== BPI-FSM8191D servo motor controller installation
=== General installation instructions
Follow the steps below to install and configure the driver module.

. According to the required operating power, select the appropriate power base plate.
. Complete all electrical links：
- Install the servo module onto the module switching base plate
- Connect the switching base plate to the power plate
- motor
- motor feedback
- Safe torque switching (STO), or shorting with a jumper
- IO control signal
- AC input power supply
. Connect the drive to the PC using a USB/232 cable.
. Power drives and PC。
. Connect to a fieldbus device (optional).
. Open FortiorTechServoStudio.exe（no need installation ）.
. use FortiorTechServoStudio Configure and debug drives.

=== FortiorTechServoStudio testing software
**FortiorTechServoStudio**

FortiorTechServoStudio is a graphical user interface (GUI) that comes with the servo module to install, configure, and debug the drive. FortiorTechServoStudio can be used to debug drive parameters online and perform specific drive operations.

image::/picture/fortiortechservostudio_1.jpg[fortiortechservostudio_1.jpg]

FortiorTechServoStudio support two methods for initial system configuration:

- Using [General - Backup and Recovery], click "Default Parameters" to complete the initial parameter configuration, then configure the motor parameters in [Motor], and configure the encoder resolution in [Feedback].
- With [General - Backup and Recovery], the motor "Import Parameters" import previously configured motor parameter data.

FortiorTechServoStudio main interface consists of 5 functional areas:

. Toolbar, containing common quick function buttons。 +
Offline|Online – Toggle FortiorTechServoStudio online/offline and display the connection status. See section [Drive Online and Offline] 。 +
Enable|Disable – Enable/disable the drive and display the enable status of the drive +
Save – Saves the parameters in the current drive RAM to the drive memory. It is recommended to use the Save button after configuring parameters to save parameter values in memory. +
No FLT — Clear drive faults. This bit turns red when the drive fails, and the motor can clear the fault.
. information bar: +
Stop —Stop the motor and disable the drive. +
Help —FortiorTechServoStudio software online help. This feature is not enabled in this version of the software. +
About —Information about the software version. In this version, the function is not available.
. sidebar: +
include FortiorTechServoStudio A navigation menu of the interface. +
The sidebar can be hidden or displayed with this arrow button. +
. Main operating interface: Displays interactive interfaces for viewing, setting, and testing parameters and configuring drives. These interfaces are described in detail in other sections of this manual +
Fault display: If there is no fault, the background of the status bar is green. If there is a fault, it is red. Click this area to open the [Fault] screen. +
Warning: If there is no warning, the background of the status bar is green; If there is a warning, it is red. +
Drive status: When the drive is enabled, the background of the status bar is green and Drive Active is displayed. When the drive is not enabled, it is red and ".
. Status bar: Displays the drive status. +
Fault display: If there is no fault, the background of the status bar is green. If there is a fault, it is red. Click this area to open the [Fault] screen. +
Warning: If there is no warning, the background of the status bar is green; If there is a warning, it is red (currently, no distinction is made between warning and fault). +
Drive status: When the drive is enabled, the background of the status bar is green and Drive Active is displayed. If the Drive is not enabled, it is red and Drive Inactive is displayed. +
Run mode: The background of this segment is gray. Displays the current running mode. +
Curr：Displays the current running current +
Vel：Displays the current motor speed. +
Pos：Displays the current position of the motor. +
Online/Offline：Connection status between the upper computer and the drive

= Upper computer
Banana Pi BPI-FSM1819D Servo motor controller Debugging tutorial: https://www.youtube.com/watch?v=At7HOSH51MA

= Referenced document
Banana Pi BPI-FSM1819D Servo module Hardware introduction and get started quickly: https://www.youtube.com/watch?v=eIMwual-9D8