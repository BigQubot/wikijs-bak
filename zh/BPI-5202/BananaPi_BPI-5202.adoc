= 基于国产龙芯Loongson 2K1000LA 工业控制网关

TIP: Allwinner A40I design: link:/en/BPI-6202/BananaPi_BPI-6202[Banana Pi BPI-6202] Embedded single board industrial Computer  +
Loongson 2K1000LA design: link:/en/BPI-5202/BananaPi_BPI-5202[Banana Pi BPI-5202] Embedded single board industrial computer

== 嵌入式工控机的定义与应用场景

工控机（Industrial Personal Computer，简称IPC），是上世纪90年代开始出现的、广泛应用于工业现场监视与控制的加固、增强型微型计算机，工控机常常会在环境比较恶劣的环境下运行，对数据的安全性要求也更高，所以工控机通常会进行加固、防尘、防潮、防腐蚀、防辐射等特别设计 截止到目前，X86+Windows（Wintel）架构，依然是工控机的主流方案，可被定义为传统工控机。一般而言

在传统工控机在工控领域的自动化和信息化方面发挥重要作用的同时，其先天弱势也一直困扰着厂家、集成商和用户。大家都在寻找更好的方案

近十年来，嵌入式系统发展迅速，以其具有的低功耗、低成本及不断提升的高性能等特点，已经成为移动设备（手机、PAD）的唯一方案；也成为包括工业控制在内的各行业实现数据采集处理的理想选择ARM架构的嵌入式系统，具有的灵活高效的软硬件方案定制特点，目前已经形成完整的产业链生态圈，能够为用户提供满足其现实需求、并有一定超前扩展余度的产品，且价格更有竞争优势的产品；当用户需求逐渐超出目前产品的能力时，又能够通过快速的方案设计与迭代，不断提供满足用户要求的新产品，能够实现“需求——技术——方案——产品——市场——用户——需求“不断上升的良性循环

相对于传统工控机，经特殊设计的基于嵌入式计算机架构的系统，被称为嵌入式工控机

传统工控机与嵌入式工控机的主要特点对比如下：

[options="header",cols="1,2,4,5"]
|====
|序号	|关键要素	|传统工控机（Windows+X86）	|嵌入式工控机（Linux+LoongArch/ARM）
|1	|性能	|商用级赛扬或商业/工业级酷睿i3~I5	|工业级，性能高于赛扬，弱于I3
|2	|安全性	|漏洞多，易受病毒和黑客攻击	|系统稳定、较少升级，安全性高
|3	|实时性	|实时响应能力较差	|实时响应能力能够满足要求
|4	|可靠性	|高功耗必须强散热，可靠性低	|低功耗无需考虑散热，可靠性高
|5	|扩展性	|在主板上扩展各类接口复杂	|在核心板/开发板上扩展各类接口较为方便
|6	|工业级	|实现真正工业级产品较为困难	|实现真正工业级产品较为容易
|7	|定制化	|定制化效率低、成本高	|面向应用快速高效订制与迭代
|8	|性能	|对工业应用而言性能不足或过剩	|针对应用，具有最佳性能方案
|9	|总体价格	|较高	|针对应用，具有价格优势
|10	|运维成本	|功耗高、运维成本高	|低功耗低成本，绿色环保
|11	|生命周期	|换代频繁，库存难以保证	|CPU生命周期较长，可保证库存
|====

嵌入式工控机已经成为传统工控机的强力竞争对手。在未来，前者形成对后者的压倒性优势，毫无悬念

== 嵌入式工控机的应用场景

工业互联网及物联网的迅速发展，既是一场众多的计算机软硬件厂家（也包括通讯方案和产品厂家，其本质也是计算机系统，甚至是嵌入式系统的软硬件厂家）尝试进入利润相对较高的行业监控市场的前赴后继的尝试；也是一场开启“民觉民智”，普及专业知识的启蒙运动。这个已经持续了十数年的大风暴，使普罗大众对监视和控制的应用需求和想象，扩展到了各行各业的每个角落

“云—管—边—端”的概念，是以互联网思维和术语，对监视控制原理做了经典的总结与归纳；但从技术发展历史看，它远非全新概念和新技术，实际上是数十年来各行业监控应用所采用的主流模式和架构

image::/bpi-5202/industrial_computer_zh_1.png[industrial_computer_zh_1.png]

* 云：实现监控中心系统及更多高级应用软件和算法的计算机系统。这里的“云”，既包括互联网上的“公有云”，也包括企业局域网上的“私有云”。构建“云”的计算机系统，目前主要为高端X86+Windows/Linux服务器，及其集群
* 管：为设备两侧提供各种效率、可靠、便捷、高性价比的有线/无线通道。不仅在“云”和”边“之间有“管”的存在，例如广域以太网网、4G/5G等；在应用现场的“边”和“端”之间，也有适合现场应用场景的有线/无线的“管”的存在，比如局域以太网、串口、高速电力线载波（HPLC）、LoRa、ZigBee、WIFI等
* 边：用于完成现场计算任务的计算机系统。边”的主要角色，早期由传统工控机、或者在要求不那么严格时，用一般的台式机及服务器来承担；目前开始出现以中高端ARM架构嵌入式系统构建嵌入式工控机的趋势
* 端：用于实现对行业应用中对主设备（一次设备）进行监视和控制的装置（二次设备）、以及物联网环境中对各类主设备进行监控的设备（二次设备）。“端”的主要角色，早期由低端的嵌入式单片机系统实现；目前以逐渐过渡到以中低端嵌入式系统（主频1GMHz以下）为主流方案

从以上的分析不难看出，工控机的应用，主要定位在“边”的层面。作为“边”的具体应用，嵌入式工控机主要承载以下两种类型的功能：

* 自动运行类，如网关、NVR、路由器、防火墙等，通过特别设计的工业级中低档嵌入式计算机系统实现。部分具有简单的基于字符/位图的展示和特殊按键的参数配置和状态显示功能
* 交互运行类，完成监控和系统（含HMI人机交互界面）等功能，通过特别设计的工业级中高档嵌入式计算机系统实现，具有矢量化图形系统的交互能力

从以上的分析不难看出，工控机的应用，主要定位在“边”的层面。作为“边”的具体应用，嵌入式工控机主要承载以下两种类型的功能：

* 自动运行类，如网关、NVR、路由器、防火墙等，通过特别设计的工业级中低档嵌入式计算机系统实现。部分具有简单的基于字符/位图的展示和特殊按键的参数配置和状态显示功能
* 交互运行类，完成监控和系统（含HMI人机交互界面）等功能，通过特别设计的工业级中高档嵌入式计算机系统实现，具有矢量化图形系统的交互能力

嵌入式系统的CPU种类很多:

* ARM系列，国外的有：恩智浦（NXP）、高通（QUALCOMM）、德州仪器（TI）、三星（SAMSUNG）；国内的有：飞腾、全志、瑞星微、海思等
* 龙芯（LoongArch）系列，龙芯家族中的2系列，主要面向“边“及高级“端”的应用；1系列，主要面向中低级“端”的应用。

== 嵌入式工控机的典型应用场景

* 智能配电房、机房动力环境、泵站、智慧园区、智慧校园、智能制造等现场的边缘“大脑”，实现与现场数采单元、测控装置、保护设备、PLC设备、CNC设备、机器人设备的接入、协议解析、报警处理、转换、整合传输与控制
* 嵌入式SCADA系统（C/S、B/S模式）
* 100ms级别的软PLC
* 工控/物联网现场小型数据服务器
* 满足“智改数转”要求的企业车间级工业看板/OEE看板、轻量级MES前端数采和展示
* 基于行业应用的第三方算法、模型的开发与运行平台
* 视频前端设备的接入与推送、视频录像与联动、视频AI分析接口及分析结果的综合联动
* 现场网络安全及审计

image::/bpi-5202/banana_pi_bpi-5202_map.jpg[banana_pi_bpi-5202_map.jpg]

= BPI-5202 龙芯2K1000LA嵌入式单板工控机

== BPI-5202 PCBA 硬件设计

BPI-5202作为单纯的嵌入式通用控制器软硬件开发平台，采用龙芯2K1000LA芯片设计，基本配置中有2个独立MAC以太网端口、2个RS485端口+1个RS232端口+2个CAN2.0端口，配置灵活，广泛适用于军工、电力、石油、厂矿、及物联网行业的自动化监控场合，为应用开发者提供功能齐全的硬件解决方案，并支持BSP+docker开发环境。提供较强算力的边缘计算支持。开发者可以快速利用开发平台，进行开发并产品化

=== PCBA 硬件接口

image::/indu-board/bpi-5020_en_int.jpg[bpi-5020_en_int.jpg]

=== PCBA 硬件规格

[cols="2,6"]
|====
| 处理器及OS	| 龙芯2K1000LAi 双核1.0GHz,Loongnix、LoongOS、LxAMP、麒麟V10
| 内存	| 4G DDR3，可配大容量SSD硬盘
| 基本通信功能	| 以太网口：2 x 1000M自适应，独立MAC,2 x RSRS485+1 x RS232+ 2 x CAN 2.0，带隔离,4G全网通
| 扩展功能模块	| 5个扩展槽位，以下模块任意组合,7 x RS485：带隔离（最多支持1个板卡扩展）;16 x DI：无源输入型，模块提供24V隔离电源;16 x DO：光耦继电器输出型，最大负载60V/500MA;8 x DI + 8 DO：继电器输出型，NC、COM、NO节点;8 x AI + 4 xAO：0-5V/4-
20mA;其它定制模块

| HMI接口	| HDMI
| USB	| USB支持键盘、鼠标；或电阻/电容显示屏接口
| 电源	| DC24V电源输入,24V隔离输出，IO板使用，500mA
                                                       
|==== 
         

=== 硬件扩展

为满足现场复杂的电气量接入需求，BPI-5202设计了5个可扩展IO槽位，每个IO槽位可根据需要配置为16xDI、16xDO、8xDI+8xDO、8xAI+4AO中的任意一种IO板卡，配合提供灵活多变的配置组合方式，并可以根据用户和项目的需求，定制各种功能板卡.

BPI-5202扩展口采用2.54mm 间距，2x10P 排针座，用来扩展IO接口。

image::/bpi-5202/banana_pi_bpi-5202_excend_sch.png[banana_pi_bpi-5202_excend_sch.png]

BPI-5202支持模块化设计，提供丰富的扩展接口，可以采用基本单元 + 5个扩展单元，支持按需配置。扩展IO单元模块包括：

* 7 x RS485模块，带隔离
* 16 x DI模块（开关输入模块），无源输入（最多支持5个模块混插）
* 16 x DO模块(开关输出模块)，继电器输出（最多支持5个模块混插）
* 8 x DI+8 x DO O模块(开关输入/输出模块)，继电器输出（最多支持5个模块混插）
* 8 x AI + 4 x AO 模块（模拟量输入输出模块），支持0-5V、0-20mA输入
* 可根据需求定制Lora、ZigBee、433M无线传输模块、电力线载波模块、以及其它功能模块
* 支持第三方自行定制功能板卡，并与BPI-5202实现通信

所有电路板都通过内部总线(485或SPI)连接在盒子里

image::/indu-board/banana_pi_bpi-6202_gateway_5.jpg[banana_pi_bpi-6202_gateway_5.jpg]

Banana Pi BPI-5202 全功能扩展网关设计

image::/indu-board/banana_pi_bpi-6202_gateway_1.jpg[banana_pi_bpi-6202_gateway_1.jpg]

== BPI-5202 工业控制网关产品介绍

BI-5202嵌入式边缘计算工控机，是基于龙芯2K1000 (LA)研发的，同时连接数十台现场电气/物联网设备/视频前端设备的国产自主可控工控机。外部机箱及接口位置可根据现场工况灵活定制。BI-5202集成了以下功能:

* 300+工业通用/行业专用协议库
* 视频接入传输/控制/录像/联动功能
* 电气IO量采集控制功能（AI/AO/DI/DO）
* 边缘计算编程功能
* 工业防火墙功能
* PLC编程功能
* C/S架构SCADA系统功能
* B/S架构SCADA系统功能

BPI-5202为导轨式安装方式，外观如下图所示。

image::/bpi-5202/banana_pi_bpi-5202_8.jpg[banana_pi_bpi-5202_8.jpg]

== BPI-5202产品典型应用场景

适用于国产化自主可控需求中涉及多通道/多协议接入、数据处理与整合、监控、SCADA和轻量级PLC的应用场景：

* 变电站/配电间自动化系统中各类（串口/网口/IO电气量）数据采集单元、测控装置、保护设备的接入、协议解析、报警处理、转换、整合传输与控制
* 机房动力环境监控、泵房监控系统中各类（串口/网口/IO电气量）自动化控制设备、PLC、变频器设备的接入、协议解析、报警处理、转换、整合传输与控制
* 智慧城市、智慧园区、智慧校园系统中各类（串口/网口/电气量IO）物联网传感器设备、控制设备的接入、协议解析、报警处理、转换、整合传输与控制
* 智能配电房、机房动力环境、泵站、智慧园区、智慧校园、智能制造等现场的视频前段设备接入
配合后台API和平台，为应用开发商和用户提供不依赖视频厂家SDK和后台系统的低成本、易开发的独立安全的视频监控整合方案

== BPI-5202主要特点

* 1,工业成品与应用开发平台, BPI-5202嵌入式通用工业控制器，有三个不同的角色：

** 作为工业成品：以其所具有的功能（轻量级PLC、协议网关、视频网关、综合网关、嵌入式SCADA系统等各种角色），直接应用于工程项目现场
** 作为二次开发的基础平台，为应用开发者提供各类开发工具和协议解析数据库接口，大大缩短各类行业应用产品的开发周、降低开发难度
作为单纯的国产化自主可控的嵌入式通用控制器软硬件平台，为应用开发者提供较强算力的边缘计算支持
* 2,工业级标准:

** 工业级低功耗设计，现场长期稳定运行
** 支持-40℃~+85℃宽温运行（高温环境下需选配合适的散热片/风扇）
** 执行GB/T17626、GB/T15153、IEC61850-3、EN61000-6-5标准，EMC III级
** 支持双机冗余
* 3,可扩展功能

** 支持定制外壳的板卡扩展，包括电气IO模块（AI / AO /DI /DO模块）、扩展串口模块、扩展以太网交换模块、HPLC通信模块、CAN通信模块、Zigbee通信模块、Lora通信模块，以及其他行业应用的定制模块，采用内部高速总线与6202主板通信

* 4,数据+视频现场整合

** 多年积累的300+国际/国家/行业/企业协议库，即插即连，提高接入效率，解析数据准确
** 视频RTSP/RTMP，Onvif/GB28181功能，流媒体服务器功能，H.264/H.265播放功能，数据联动短视频联动报警录像功能，摄像头  AI分析事件捕获/上传功能（近期发布），数据OSD打码功能（近期发布）
** 解决长期以来视频监控独立于数据监控、需要视频厂家前端+后端绑定方案痼疾和痛点

* 5,轻量级PLC功能

** 通过IEC61131-3编程语言，可针对网关内所有数据进行PLC方式编程，通过电气IO模块，实现轻量级PLC功能

* 6,多种南向/北向通信方式

** 支持2个独立MAC千兆自适应网口
** 支持2个RS485和1个RS232串口；通过机箱扩展和扩展板，可以多支持7个RS485
** 支持2路CAN接口；
** 支持扩展WIFI、4G/5G通信

* 7,HMI及上位机功能集成

** 通过HDMI/USB接口连接触摸屏/大屏-键盘-鼠标，应用程序可实现友好的HMI交互
** 配合内置的全功能SCADA系统（C/S架构和B/S架构），取代现场X86+Windows架构的上位机计算机系统，适合无人值守环境，具有极高的性价比

* 8,多核架构、资源丰富、算力充裕
** 龙芯高性能处理器2K1000LA，主频1.0GHz，4G DDR3
** 1 x M.2 SATA硬盘接口，可接入SSD硬盘
** 1 x mini PCIE接口，可接入4G模块、Wifi模块或AI算力卡；
** 内置软件狗加密芯片
** 可信平台模块，保障设备与通信安全

* 9,多种二次开发接口

** C、表达式、梯形图、Java、Python、SqLite编程接口
** Docker功能

== 内部逻辑结构

image::/bpi-5202/bpi-5020_1.png[bpi-5020_1.png]

== 外部连接方式

image::/bpi-5202/banana_pi_bpi-5202_way.png[banana_pi_bpi-5202_way.png]

== BPI-5202技术说明

为满足各关键行业项目对国产化自主可控产品的需要，而特别设计的BPI-5202，基本配置中有2个独立MAC以太网端口、2个RS485端口+1个RS232端口+2个CAN2.0端口，配置灵活，广泛适用于军工、电力、石油、厂矿、及物联网行业的自动化监控场合

为满足现场复杂的电气量接入需求，BPI-5202设计了5个可扩展IO槽位，每个IO槽位可根据需要配置为16xDI、16xDO、8xDI+8xDO、8xAI+4AO中的任意一种IO板卡，配合提供灵活多变的配置组合方式，并可以根据用户和项目的需求，定制各种功能板卡

BPI-5202内置300+规约解释库和实时数据库，可连接国内外各种保护装置、测控装置、IEDs等设备，并支持IEC61850。可根据用户要求定制特殊规约；提供开放的API，方便用户自行开发规约软件，规约软件可独立下载

BPI-5202支持近百台设备的接入，数据协议解析、转换与统一传输

BPI-5202具有强大的视频处理能力，包括RTSP/RTMP视频推拉流、Onvif/GB28181协议栈等视频监控传输功能，实现对多厂家视频前端设备（IPC、NVR）的兼容接入，配置大容量硬盘后可取代NVR，实现视频录像及回放功能。独有的基于数据+视频的联动功能，提供了业界唯一的数据+视频完美融合的解决方案

BPI-5202通过HDMI显示接口和USB键盘鼠标（或触摸屏），支持2048点以下完整的SCADA系统功能

BPI-5202支持三种配置方式：

* 内置WEB管理，通过浏览器查询／配置设备的工作参数
* 专用的配置软件配置设备参数
* 云端远程管理，通过云端对参数进行配置和诊断，实现固件和应用程序的升级

BPI-5202使用了先进的数字隔离技术、RS485自动方向控制、RS485零延时传送技术，在设计上充分考虑了工业现场应用的特殊性，遵循EMI/EMC设计规范，适应各种严酷的工业现场和物联网现场，保障通信以及各种IO信号量的可靠

NOTE: 1)BPI-5202系列嵌入式边缘计算工控机采用DC24V供电。

== BPI-5202产品主要功能

* 1)内置300+通讯规约库（详见协议列表清单），包括：MQTT及其它物联网协议、BACNET、OPC UA、IEC 60870-5-101/103/104、CDT、SPABUS、标准MODBUS及数十个变种，即插即通；可根据需求快速定制特殊协议，可提供二次开发环境
* 2)支持西门子/AB/施耐德/三菱等各类PLC连接
* 3)支持IEC61850 Server/Client功能，实现传统规约与61850的双向转换
* 4)视频流获取、传输、分发，云台控制、本地流媒体服务器功能
* )加密传输、断点续传
* 6)内置RTC，提供高精度时间参考
* 7)模块化设计，基本单元 + 5个扩展单元，支持按需配置。扩展IO单元模块包括：
* 7 x RS485模块，带隔离
** 16 x DI模块（开关输入模块），无源输入（最多支持5个模块混插）
** 16 x DO模块(开关输出模块)，继电器输出（最多支持5个模块混插）
** 8 x DI+8 x DO O模块(开关输入/输出模块)，继电器输出（最多支持5个模块混插）
** 8 x AI + 4 x AO 模块（模拟量输入输出模块），支持0-5V、0-20mA输入
** 可根据需求定制Lora、ZigBee、433M无线传输模块、电力线载波模块、以及其它功能模块
** 支持第三方自行定制功能板卡，并与CS5202LS-IC实现通信
* 8)HDMI/USB接口，配合嵌入式SCADA系统的UI操作
* 9)本地设备配置管理，云端设备配置管理
* 10)Telnet、SNMP服务
* 11)电磁兼容性设计，符合国际相关标准，具有良好的抗干扰能力
* 12)可进行二次开发，提供完整的协议开发包，可定制各种协议
* 13)全功能SCADA功能
* 14)导轨式安装方式，造型美观，组屏方便

== BPI-5202 主要技术规格
[cols="2,6"]
|====
|项目|	说明
|处理器及OS	|龙芯2K1000LAi 双核1.0GHz,Loongnix、LoongOS、LxAMP、麒麟V10
|内存	|4G DDR3，可配大容量SSD硬盘
|基本通信功能 |	以太网口：2 x 1000M自适应，独立MAC;2 x RSRS485+1 x RS232+ 2 x CAN 2.0，带隔离;4G全网通
|扩展功能模块	|可选
|USB	|USB支持键盘、鼠标；或电阻/电容显示屏接口
|数据处理能力	|设备接入能力：<=64台（根据带宽和采样周期可调）;模拟量<8192;数字量<8192;控制量<8192;表达式计算定义、报警处理
|视频处理能力|	视频RTSP/RTMP、Onvif、GB28181;视频录像、回放;数据触发片段视频录像、上传;AI摄像头图像AI分析事件捕获、数据OSD打码;本地流媒体服务;H.264/H.265播放
|HMI接口	|HDMI
|SCADA功能	|全功能SCADA系统，处理点数：2048点
|开发环境|	C/表达式/梯形图/Java/Python等边缘计算二次开发环境
|加密芯片|	无
|电源 |	DC24V电源输入,24V隔离输出，IO板使用，500mA
|====

== 环境规格
[cols="2,6"]
|====
|项目	|说明
|工作温度	|-40~+60℃
|存储温度	|-40~+75℃
|工作湿度（RH）	|5%~95%无冷凝
|存储湿度（RH）|	5%~95%无冷凝
|海拔高度	|<5000m
|防雷	|内置防雷元件，支持户外使用，符合高等级EMC标准
|防护等级	|IP40
|散热方式	|无风扇自然散热
|电磁兼容|	EMC III级，GB/T17626、GB/T15153、IEC61850-3、EN61000-6-5
|安规	|GB/T7621-2008
|认证	|CE认证
|====

== 物理规格
[cols="2,6"]
|====
|尺寸（宽x深x高）	|36mm x105mm x 145mm，导轨式安装,定制扩展的宽度为30mm x n+6（n≥2，为定制扩展时的宽度）
|重量	|0.5kg
|功耗	|典型功耗：5W ,最大功耗：10W
|====

= 合作方式

1,BPI-5202为一款开源硬件产品，Banana Pi 社区提供所有的BSP板级支持代码，并在代码中支持Docker容器。 有技术开发能力的客户，直接在BPI-6202上进行二次应用开发。

2,BPI-5202作为二次开发的基础平台，为应用开发者提供各类开发工具和协议解析数据库接口，大大缩短各类行业应用产品的开发周、降低开发难度

3,BPI-5202为完整工控产品，客户可以直接用来进行工业控制，提供完全的产品级支持。
image::/bpi-5202/banana_pi_bpi-5202_excend_sch.png[banana_pi_bpi-5202_excend_sch.png]