= Introduction

Banana Pi BPI-AI2N System-on-Module (SoM) and BPI-AI2N carrier board are open-source hardware solutions designed to leverage the advanced capabilities of the RZ/V2N Vision AI MPU. It supports 8GB memory, 32GB emmc, dual gigabit ethernet ports, 2x USB3 interface.

== Specifications

- SoC – Renesas RZ/V2N quad-core 64bit Arm Cortex-A55 processor @ up to 1.8 GHz with Mali-G31 GPU
- System Memory – 8GB LPDDR4
- Storage – 32GB eMMC flash, MicroSD slot
- Video Output – MIPI DSI to hdmi connector, up to 1080p
- Connectivity – Dual Gigabit Ethernet
- USB – 2x USB 3.0 ports,1x USB-C port
- Expansion – 40-pin header with 28x GPIO, UART, I2C, SPI, PWM, and power signal (+5V, +3.3V, GND).
- Debugging – USB Type-C debug header
- Power Supply – 12V @3A via USB Type-C port

= Development
== Prepare

. Linux image support SDcard or EMMC bootup.
. It’s recommended to use A1 rated cards, 16GB at least.
. Make sure bootable EMMC is formatted if you want bootup from SDcard Yocto
. Download latest Linux Image, and confirm that the checksum is correct.
. Default login: pi/bananapi or root/bananapi

== Install Image to SDcard

> Install Image with Balena Etcher on Windows, Linux and MacOS.

link:https://balena.io/etcher[Balena Etcher] is an opensource GUI flash tool by Balena, Flash OS images to SDcard or USB drive.

- Click on "**Flash from file**" to select image. 
- Click on "**Select target**" to select USB device. 
- Click on "**Flash!**" Start burning.

image::/picture/etcher.jpg[etcher.jpg]

> Install Image with Balena Cli on Windows, Linux and MacOS.

link:https://github.com/balena-io/balena-cli[Balena CLI] is a Command Line Interface for balenaCloud or openBalena. It can be used to flash linux image. Download the installer or standalone package from link:https://github.com/balena-io/balena-cli/releases[balena-io] and link:https://github.com/balena-io/balena-cli/blob/master/INSTALL.md[install ]it correctly to your PC, then you can use the "link:https://docs.balena.io/reference/balena-cli/#local-flash-image[local flash]" command option of balena to flash a linux image to sdcard or usb drive.

```sh
  $ sudo balena local flash path/to/xxx-bpi-ai2n-xxx.img.xz
  $ sudo balena local flash path/to/xxx-bpi-ai2n-xxx.img.xz --drive /dev/disk2
  $ sudo balena local flash path/to/xxx-bpi-ai2n-xxx.img.xz --drive /dev/disk2 --yes
```

> Install Image with dd command on Linux

umount SDcard device /dev/sdX partition if mounted automatically. 

```sh
 $ sudo apt-get install xz-utils pv
 $ sudo sh -c 'xzcat xxx-bpi-ai2n-xxx.img.xz | pv | dd of=/dev/sdX bs=1M status=progress && sync'
```

== Install Image to eMMC

. Prepare a SDcard with Linux image flashed and bootup board with this SDcard.
. Copy Linux image to udisk, plug the udisk to board and mount it.
. Install with dd command, umount mmcblk0p1 and mmcblk0p2 partition if mounted automatically. 

```sh
 $ sudo apt-get install xz-utils pv
 $ sudo sh -c 'xzcat xxx-bpi-ai2n-xxx.img.xz | pv | dd of=/dev/sdX bs=1M status=progress && sync'
```

== Build Linux Source Code
Get source code

```sh
 $ git clone 
```
Build source code

```sh
 $  
```

=== Networking

. Desktop
+
Right click the nm applet icon in the system tray, and click Connection Information item, popup window displays all the network configuraton

. Command line
+
Run the following command to output your IP address to the command line:

```sh
 $ hostname -I
 10.0.1.6
```

== DTB overlay
DTB overlay is used for 40pin gpios multi-function configuration 

```sh
 $ ls /boot/dtb/renesas/overlay/
 README.renesas-overlays
 renesas-fixup.scr
 renesas-rzv2n-i2c1.dtbo
 renesas-rzv2n-i2c1-flash.dtbo
 renesas-rzv2n-i2c1-rtc.dtbo
 renesas-rzv2n-i2c2.dtbo
 renesas-rzv2n-i2s3-nxez-pcm512x.dtbo
 renesas-rzv2n-i2s3-waveshare-wm8960.dtbo
 renesas-rzv2n-spi0.dtbo
 renesas-rzv2n-spi2.dtbo
 renesas-rzv2n-spi2-flash.dtbo
 renesas-rzv2n-spi2-waveshare-st7789v.dtbo
 renesas-rzv2n-spi2-waveshare-tft24.dtbo
 renesas-rzv2n-spi2-waveshare-tft35c.dtbo
 renesas-rzv2n-uart0.dtbo
 renesas-rzv2n-uart2.dtbo
```
Configure overlays with GUI tool armbian-config, go to **System->Kernel->DTO**

```sh
 $ sudo armbian-config
```

image::/picture/ai2n_overlay.png[ai2n_overlay.png]

more info of overlays configuration using armbian-config, please ref to link:https://docs.armbian.com/User-Guide_Armbian-Config/System/#device-tree-overlays[Armbian-Config Device Tree Overlays]

Alternatively, add names of overlays you want to activate to **overlays=** line in **/boot/armbianEnv.txt**, separated with spaces. For example, enable i2c2, spi2 and uart0 overlays

```sh
 overlays=i2c1 spi2 uart0
```

Reboot the board to apply overlays configuration


== Libgpiod

== Python3-periphery

== Adafruit-Blinka

== WiringPi
WARNING: Note: This WiringPi only support set 40pin gpio to output, input, for io functions as i2c, spi, pwm..., you must enable dtb overlays

Build and install wiringPi, for debian, you must install sudo before build

```sh
 $ sudo apt-get update
 $ sudo apt-get install build-essential git
 $ git clone https://github.com/Dangku/WiringPi
 $ cd WiringPi
 $ chmod a+x build
 $ sudo ./build
```
Run gpio readall to show all 40pins status.
```sh
 $ sudo gpio readall
 +-----+-----+---------+------+---+-- AI2N --+---+------+---------+-----+-----+
 | I/O | wPi |   Name  | Mode | V | Physical | V | Mode |  Name   | wPi | I/O |
 +-----+-----+---------+------+---+----++----+---+------+---------+-----+-----+
 |     |     |    3.3V |      |   |  1 || 2  |   |      | 5V      |     |     |
 | 442 |   8 |   SDA.1 | HI-Z | 0 |  3 || 4  |   |      | 5V      |     |     |
 | 443 |   9 |   SCL.1 | HI-Z | 0 |  5 || 6  |   |      | 0V      |     |     |
 | 484 |   7 |  IO.484 | HI-Z | 0 |  7 || 8  | 0 | HI-Z | TxD2    | 15  | 460 |
 |     |     |      0V |      |   |  9 || 10 | 0 | HI-Z | RxD2    | 16  | 461 |
 | 488 |   0 |  IO.488 | HI-Z | 0 | 11 || 12 | 0 | HI-Z | IO.426  | 1   | 426 |
 | 489 |   2 |  IO.489 | HI-Z | 0 | 13 || 14 |   |      | 0V      |     |     |
 | 490 |   3 |  IO.490 | HI-Z | 0 | 15 || 16 | 0 | HI-Z | IO.463  | 4   | 463 |
 |     |     |    3.3V |      |   | 17 || 18 | 0 | HI-Z | IO.462  | 5   | 462 |
 | 508 |  12 |    MOSI | HI-Z | 0 | 19 || 20 |   |      | 0V      |     |     |
 | 507 |  13 |    MISO | HI-Z | 0 | 21 || 22 | 0 | HI-Z | IO.459  | 6   | 459 |
 | 509 |  14 |    SLCK | HI-Z | 0 | 23 || 24 | 0 | HI-Z | SS      | 10  | 503 |
 |     |     |      0V |      |   | 25 || 26 | 0 | HI-Z | IO.502  | 11  | 502 |
 | 432 |  30 |   SDA.2 | HI-Z | 0 | 27 || 28 | 0 | HI-Z | SCL.2   | 31  | 433 |
 | 491 |  21 |  IO.491 | HI-Z | 0 | 29 || 30 |   |      | 0V      |     |     |
 | 493 |  22 |  IO.493 | HI-Z | 0 | 31 || 32 | 0 | HI-Z | IO.456  | 26  | 456 |
 | 458 |  23 |  IO.458 | HI-Z | 0 | 33 || 34 |   |      | 0V      |     |     |
 | 427 |  24 |  IO.427 | HI-Z | 0 | 35 || 36 | 0 | HI-Z | IO.457  | 27  | 457 |
 | 495 |  25 |  IO.495 | HI-Z | 0 | 37 || 38 | 0 | HI-Z | IO.429  | 28  | 429 |
 |     |     |      0V |      |   | 39 || 40 | 0 | HI-Z | IO.420  | 29  | 420 |
 +-----+-----+---------+------+---+----++----+---+------+---------+-----+-----+
 | I/O | wPi |   Name  | Mode | V | Physical | V | Mode |  Name   | wPi | I/O |
 +-----+-----+---------+------+---+-- AI2N --+---+------+---------+-----+-----+
```

BPI GPIO Extend board and examples in link:https://github.com/Dangku/WiringPi/tree/master/examples[WiringPi/examples]

. blinkall: blink all pin header gpios, no extend board.
. lcd-bpi: link:/en/BPI-LCD_1602/BananaPi_BPI-LCD_1602[BPI LCD 1602 display module]. +
. 52pi-bpi: link:/en/BPI-OLED/BananaPi_BPI-OLED[BPI OLED Display Module] example
. matrixled-bpi: link:/en/BPI-RGB_LED/BananaPi_BPI_RGB_LED[BPI RGB LED Matrix Expansion Module]
. berryclip-bpi: link:/en/BPI-BerrClip/BananaPi_BPI-BerryClip[BPI BerryClip Module]

== RPi.GPIO

Build and install.
```sh
 $ sudo apt-get update
 $ sudo apt-get install build-essential python3 python3-pip python3-dev python3-setuptools git
 $ git clone https://github.com/Dangku/RPi.GPIO.git
 $ cd RPi.GPIO
 $ sudo python3 setup.py clean --all
 $ sudo python3 setup.py install
```
Create and install wheel package
```sh
 $ sudo python3 setup.py bdist_wheel
 $ sudo pip3 install dist/RPi.GPIO-XXX.whl
```
Install from git source directly without development
```sh
 $ sudo pip3 install git+https://github.com/Dangku/RPi.GPIO.git
```
If the package is already installed, it should be uninstalled before installing the new one, or installing the new one with --force-reinstall option.

== WiringPi-Python

Build and install.
```sh
 $ sudo apt-get update
 $ sudo apt-get install build-essential python3 python3-dev python3-setuptools swig git
 $ git clone --recursive  https://github.com/Dangku/WiringPi-Python.git
 $ cd WiringPi-Python
 $ sudo python3 setup.py install
```

== Install Docker Engine

link:https://docs.docker.com/engine/install/[Install Docker Engine] with a simple command

```sh
 $ curl -sSL get.docker.com | sudo sh
```

Verify the Docker Engine is installed correctly by running the hello-world image.

```sh
 $ sudo docker run hello-world
 Unable to find image 'hello-world:latest' locally
 latest: Pulling from library/hello-world
 c9c5fd25a1bd: Pull complete 
 Digest: sha256:0b6a027b5cf322f09f6706c754e086a232ec1ddba835c8a15c6cb74ef0d43c29
 Status: Downloaded newer image for hello-world:latest
 
 Hello from Docker!
 This message shows that your installation appears to be working correctly.
 
 To generate this message, Docker took the following steps:
  1. The Docker client contacted the Docker daemon.
  2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
     (arm64v8)
  3. The Docker daemon created a new container from that image which runs the
     executable that produces the output you are currently reading.
  4. The Docker daemon streamed that output to the Docker client, which sent it
     to your terminal.
 
 To try something more ambitious, you can run an Ubuntu container with:
  $ docker run -it ubuntu bash
 
 Share images, automate workflows, and more with a free Docker ID:
  https://hub.docker.com/
 
 For more examples and ideas, visit:
  https://docs.docker.com/get-started/
```

== Remote access

Sometimes you need to access the board without connecting it to a monitor, keyboard, and mouse, To remotely control your bananapi board from another device on your local network, use one of the following services:

. SSH
. VNC

Before enabling remote access, please find the ip address of your board

. Desktop
+
Right click the nm applet icon in the system tray, and click Connection Information item, popup window displays all the network information.

+
image::/picture/ai2n-find-ip.png[ai2n-find-ip.png]

. Command line
+
Run the following command to output your IP address to the command line:

```sh
 $ hostname -I
 10.0.1.6
```

=== SSH
Open a terminal window on your computer and enter the following command, replacing the <ip address> placeholder with the IP address of bananapi board you’re trying to connect to and <username> with your username:

```sh
 $ ssh pi@10.0.1.6
```

=== VNC
x11vnc

. Install x11vnc
+
```sh
 $ sudo apt install x11vnc
```

. Create a password file
+
```sh
 $ x11vnc -storepasswd
 Enter VNC password: 
 Verify password:    
 Write password to /home/pi/.vnc/passwd?  [y]/n y
 Password written to: /home/pi/.vnc/passwd
```

. Create service file /lib/systemd/system/x11-vnc.service
+
```sh
[Unit]
Description="x11vnc"
Requires=display-manager.service
After=lightdm.service

[Service]
ExecStart=/usr/bin/x11vnc -auth guess -loop -forever -safer -shared -ultrafilexfer -bg -o /var/log/x11vnc.log
ExecStop=/usr/bin/killall x11vnc

[Install]
WantedBy=multi-user.target
```

. Enable service
+
```sh
sudo systemctl daemon-reload
sudo systemctl enable x11-vnc
sudo systemctl start x11-vnc
```

. Connect to VNC server
+
Install tigervnc and launch it on the client device
+
```sh
 $ sudo apt install tigervnc-viewer
 $ vncviewer 10.0.1.6
```
+
image::/picture/ai2n-vncview.png[ai2n-vncview.png]

