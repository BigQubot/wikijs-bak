= Overview

Banana Pi BPI-R4Pro Router board with MediaTek MT7988A (Filogic 880) quad-core ARM Corex-A73 design ,4GB DDR4 RAM,8GB eMMC,128MB SPI-NAND flash onboard, also have 2x 10Gbe SFP, 4x Gbe network port,with USB3.2 port,M.2 support 4G/5G/NVME SSD.2x miniPCIe slots with PCIe3.0 2lane interface for Wi-Fi 7 NIC (Network Interface Card). It is a very high performance open source router development board.

TIP: More Infomation: link:https://docs.banana-pi.org/en/BPI-R4_Pro/BananaPi_BPI-R4_Pro[Banana Pi BPI-R4Pro]

== Block Diagram(8X)
image::/bpi-r4_pro/bpi-r4pro-block_diagram_8x.png[bpi-r4pro-block_diagram_8x.png,width=800]

= Development
== Preparation

* 8G/above MicroSD card +
* MicroSD card Reader +
* USB Disk +
* USB TypeC cable +
* CAT6A Ethernet cable +
* 12V/5A power adapter +
(without any peripherals and network cable inset, the power consumption of BPI-R4Pro Main Board is about 10W, so 12V/2A will work. +
But you need to determine whether you need a higher power power adapter according to your own accessory usage,12V/5A is recommended) +
* Windows/Ubuntu System +
* BPI-R4Pro image to be flashed


== BPI-R4Pro bootstrap setting
The tables below list the settings of the switch (SW3) and their functions. +

image::/bpi-r4_pro/bpi-r4pro-bootstrap3.png[bpi-r4pro-bootstrap3.png,width=300]

. All Jumper is "1", BPI-R4Pro will boot from SD card 
+
image::/bpi-r4_pro/bpi-r4pro-boot_for_sd.png[bpi-r4pro-boot_for_sd.png,width=800]


. SW3-A is "0" and SW3-B is "1" , BPI-R4Pro will boot from SPI NAND
+
image::/bpi-r4_pro/bpi-r4pro-boot_for_nand.png[bpi-r4pro-boot_for_nand.png,width=800]


. SW3-A is "1" and SW3-B is "0" , BPI-R4Pro will boot from eMMC
+
image::/bpi-r4_pro/bpi-r4pro-boot_for_emmc.png[bpi-r4pro-boot_for_emmc.png,width=800]


. If the console said "system halt!", it means that the bootup storage does not cotain any OS
+
```bash
  System halt!
```

== Power Supply

* Using your USB TypeC cable Connect to debug console(CN41) on BPI-R4Pro +
* Install Terminal Emulator or use a serial terminal that you are familiar with， +
  change the setting as follows: Baud=115200,Data bits: 8bit,Parity: none,Stop: 1bit, Flow control: none;
* Set up the bootstrap switch before supplying power， +
  （If you are using BPI-R4Pro for the first time, it is recommended to set it to NAND boot) +
* when Connect power adapter to DC-IN connector(CN44),Green LED “PWR” light up， +
  And there will be characters similar to the following on the console. +
  This means you have successfully started BPI-R4Pro. +
```bash
F0: 102B 0000
FA: 1042 0000
FA: 1042 0000 [0200]
F9: 0000 0000
V0: 0000 0000 [0001]
00: 0000 0000
BP: 0600 0041 [0000]
G0: 1190 0000
EC: 0000 0000 [1000]
MK: 0000 0000 [0000]
T0: 0000 01A6 [0101]
Jump to BL

NOTICE:  BL2: v2.10.0   (release):OpenWrt v2024.01.17~bacca82a-3 (mt7988-spim-nand-ubi-comb)
NOTICE:  BL2: Built : 03:09:13, Jun 17 2025
NOTICE:  WDT: Cold boot
NOTICE:  WDT: disabled
NOTICE:  CPU: MT7988
NOTICE:  EMI: DDR4 4BG mode
NOTICE:  EMI: Using DDR unknown settings
NOTICE:  EMI: Detected DRAM size: 8192 MB
NOTICE:  EMI: complex R/W mem test passed
NOTICE:  SPI_NAND parses attributes from parameter page.
NOTICE:  SPI_NAND Detected ID 0xef
NOTICE:  Page size 2048, Block size 131072, size 268435456
NOTICE:  UBI: scanning [0x200000 - 0x10000000] ...
NOTICE:  UBI: Bad EC magic in block 1904 4e4d4d31
NOTICE:  UBI: Bad EC magic in block 1905 ffffffff
NOTICE:  UBI: Bad EC magic in block 1906 ffffffff
NOTICE:  UBI: Bad EC magic in block 1907 4e4d4d31
NOTICE:  UBI: Bad VID magic in block 2031 4e4d4d30
NOTICE:  UBI: scanning is finished
NOTICE:  UBI: PEB size: 131072 bytes (128 KiB), LEB size: 126976 bytes
NOTICE:  UBI: VID header offset: 2048 (aligned 2048), data offset: 4096
NOTICE:  UBI: Volume fip (Id #2) size is 1132873 bytes
NOTICE:  BL2: Booting BL31
NOTICE:  BL31: v2.10.0  (release):OpenWrt v2024.01.17~bacca82a-3 (mt7988-spim-nand-ubi-comb)
NOTICE:  BL31: Built : 03:09:13, Jun 17 2025


U-Boot 2024.10-OpenWrt-unknown (Jun 17 2025 - 03:09:13 +0000)

CPU:   MediaTek MT7988
Model: BananaPi BPI-R4 Pro 8X
DRAM:  8 GiB
Core:  65 devices, 23 uclasses, devicetree: embed
spi-nand: spi_nand spi_nand@0: Winbond SPI NAND was found.
spi-nand: spi_nand spi_nand@0: 256 MiB, block size: 128 KiB, page size: 2048, OOB size: 128
MMC:   mmc@11230000: 0
Loading Environment from UBI... Read 126976 bytes from volume ubootenv to 00000000ff7c1c00
Read 126976 bytes from volume ubootenv2 to 00000000ff7e0c40
```



== Flashing image
If you want to change the factory default system to another one, +
Place link:https://docs.banana-pi.org/en/BPI-R4/BananaPi_BPI-R4#_system_image[Download the image] file into a windows/ubuntu PC and  follow the steps below. +


=== How to flash image to SD card
NOTE: **Please low level format the SD and clear all data of SD. It's very important.** +
**Otherwise, you will encounter a "jffs2" error during the startup process.
**

- Please follow the following diagram for Windows PC.
+
image::/picture/low_level_format_sd_card.png[low_level_format_sd_card.png]

- Linux PC, you can use the "**mksf**" command for formatting, or use the "**dd**" command to write zeros.

**Flash image to SD card on windows computer**

link:https://balena.io/etcher[Balena Etcher] is an opensource GUI flash tool by Balena, Flash OS images to SDcard or USB drive.

- Click on "**Flash from file**" to select image. 
- Click on "**Select target**" to select USB device. 
- Click on "**Flash!**" Start flashing.

image::/picture/etcher.jpg[etcher.jpg]

**Flash image to SD card on linux computer**

. You could download latest image from our forum     
. Install bpi-tools on your Ubuntu. If you can't access this URL or any other problems, please go to bpi-tools repo and install this tools manually.
+
```sh
apt-get install pv
curl -sL https://github.com/BPI-SINOVOIP/bpi-tools/raw/master/bpi-tools | sudo -E bash
```
. After you download the image, insert your TF card into your Ubuntu. Execute
+
```sh
bpi-copy xxx.img /dev/sdx
```
to install image on your TF card

. After step 3, then you can insert your TF card into R4, and press power button to setup R4
 
**Change Boot Jumper to boot from SD, Enable SD Card Device.** +




=== How to flash image to NAND Flash
Before flashing image into Nand, please prepare a USB disk. Let's take OpenWrt image (**mtk-bpi-r4pro-NAND-20250928.img**) for example, the steps are below:

. Copy Nand boot OpenWrt image(**mtk-bpi-r4pro-NAND-20250928.img**) to USB disk. 
. Change the bootstrap to sd boot, then power up the board.
. Plug in USB disk to the board, and mount the USB to /mnt or other directory as follows: (you can skip mounting if it is mounted automatically)
+
```SH
mount -t vfat /dev/sda1 /mnt 
cd /mnt
```
. Execute following command to erase the whole Nand flash and copy image to nand device:
+
```sh
mtd erase /dev/mtd0
mtd write mtk-bpi-r4pro-NAND-20250928.img /dev/mtd0
```
. Power off BPI-R4 board, unplug u-disk driver, change bootstrap to boot from Nand device.




=== How to flash image to eMMC


= Interface

== 10G SFP+

== 10G RJ45

== 2.5G RJ45

== 1G RJ45

== 1G FPC Connector

== miniPCIe Slot(FOR WiFi NIC)

== M.2 B-KEY Slot(FOR 4G/5G Module)
=== SIM Slot
=== EXT SIM Slot
=== eSIM
=== 3.3V/3.95V Power
=== LED


== M.2 M-KEY Slot(FOR PCIe NVME SSD)

== USB connector
=== USB3.2 connector
=== USB2.0 connector

== USB TypC Debug Console connector

== USB TypC PD connector

== MicroSD Card

== FAN

== RTC

== Button
=== Reset
=== WPS

== DC-IN 

== DC-OUT

== LEDs

= PIN Definition 
== 26 Pin GPIO define(CON1)
== FAN (CN36/CN38)
== External LED connector(CN40)
== External SIM Card connector(CN45)
== DC-IN connector(CN44)
== DC-IN connector(CN6)
== DC-OUT connector(CN3)
== DC-OUT connector(CN2)
== 1G FPC Connector(CN37)

