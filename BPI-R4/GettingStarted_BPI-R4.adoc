= Introduction

TIP: More Infomation: link:/en/BPI-R4/BananaPi_BPI-R4[Banana Pi BPI-R4]

= Development
== Prepare

* Prepare 8G/above TF card, USB-Serial cable, Ubuntu System
* Using your USB-Serial cable(3.3V TTL,Baud=115200) Connect to debug console on BPI-R4
   G=GND;  RX=BPI-R4 input;  TX=BPI-R4 output

image::/picture/r4_debugport.jpg[r4_debugport.jpg]

=== BPI-R4 bootstrap and device select Jumper Setting:
image::/picture/r4-bootstrip.png[r4-bootstrip.png]

. All Jumper is "1", BPI-R4 will boot from SD card 
+
image::/picture/r4_sdboot.jpg[r4_sdboot.jpg]

. SW3-A is "0" and SW3-B is "1" , BPI-R4 will boot from SPI NAND
+
image::/picture/r4_nandboot.jpg[r4_nandboot.jpg]

. SW3-A is "1" and SW3-B is "0" , BPI-R4 will boot from eMMC
+
image::/picture/r4_emmcboot.jpg[r4_emmcboot.jpg]

. If the console said "system halt!", it means that the bootup storage does not cotain any OS
+
image::/picture/r4_systenhalt.png[r4_systenhalt.png]

== Linux
=== Install Image to SD card
**Windows PC**

Install Image with Balena Etcher. +
link:https://balena.io/etcher[Balena Etcher] is an opensource GUI flash tool by Balena, Flash OS images to SDcard or USB drive.

. Click on "**Flash from file**" to select image. 
. Click on "**Select target**" to select USB device. 
. Click on "**Flash!**" Start burning.

image::/picture/etcher.jpg[etcher.jpg]

**Linux PC**

. Install bpi-tools on your Ubuntu. If you can't access this URL or any other problems, please go to bpi-tools repo and install this tools manually.
+
```sh
apt-get install pv
curl -sL https://github.com/BPI-SINOVOIP/bpi-tools/raw/master/bpi-tools | sudo -E bash
```
. After you download the image, insert your TF card into your Ubuntu.Execute 
+
```sh
bpi-copy xxx.img /dev/sdx
```
 
**Change Boot Jumper to boot from SD, Enable SD Card Device.**

image::/picture/bpi-r4_sdboot.jpg[bpi-r4_sdboot.jpg]
=== Install Image to Nand

NOTE: Note: when you want to Update Nand device, Firstly Change boot switch to boot from SD device and insert one SD with SD boot Image, then after boot up,you need flash one nand image into nand device. Finally you change bootstrap to boot from Nand device.

Before burning image into Nand, please prepare a USB disk. Let's take OpenWrt image (mtk-bpi-r4-NAND-20231030.img) for example, the steps are below:

. Copy Nand boot OpenWrt image(mtk-bpi-r4-NAND-20231030.img) to USB disk.
  
. Change boot switch Jumper, the board boot from SD device, then power up the board.
 
. Plug in USB disk to the board, and mount the USB to /mnt or other directory as follows: (you can skip mounting if it is mounted automatically)
+
```sh
mount -t vfat /dev/sda1 /mnt 
cd /mnt
```
. Execute following command to erase the whole Nand flash and copy image to nand device:
+
```sh
mtd erase /dev/mtd0
dd if=mtk-bpi-r4-NAND-20231030.img of=/dev/mtdblock0
```

. Power off BPI-R4 board, unplug u-disk driver, change bootstrap to boot from Nand device.

=== Install Image to eMMC

NOTE: Note: because SD card and EMMC device share one SOC's controller, it is necessary to switch to NAND startup and then burn the EMMC image into the EMMC. Finally, you will change the boot to boot from EMMC.

Before burning image to eMMC, please prepare a USB disk. Let's take OpenWrt image (bl2_emmc-r4.img, mtk-bpi-r4-EMMC-20231030.img) for example, the steps are below:

. Copy EMMC boot OpenWrt image(bl2_emmc-r4.img, mtk-bpi-r4-EMMC-20231030.img) to USB disk, if the image is compressed please uncompress it before copying to USB disk.

. Change the switch jumper to Nand and start the motherboard from Nand.
 
. Plug in USB disk to the board, and mount the USB to /mnt or other directory as follows: (you can skip mounting if it is mounted automatically)
+
```sh
mount -t vfat /dev/sda1 /mnt 
change your directory to the mounting point, here is : cd /mnt
```

. Execute :
+
```sh
echo 0 > /sys/block/mmcblk0boot0/force_ro
dd if=bl2_emmc-r4.img of=/dev/mmcblk0boot0
dd if=mtk-bpi-r4-EMMC-20231030.img of=/dev/mmcblk0
mmc bootpart enable 1 1 /dev/mmcblk0
```
. Power off R4 board, remove u-disk driver, change bootstrap to boot from emmc device.
