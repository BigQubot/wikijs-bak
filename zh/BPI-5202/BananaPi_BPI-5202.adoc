= 基于国产龙芯Loongson 2K1000LA 工业控制网关

TIP: Allwinner A40I design: link:/en/BPI-6202/BananaPi_BPI-6202[Banana Pi BPI-6202] Embedded single board industrial Computer  +
Loongson 2K1000LA design: link:/en/BPI-5202/BananaPi_BPI-5202[Banana Pi BPI-5202] Embedded single board industrial computer

== 嵌入式工控机的定义与应用场景

工控机（Industrial Personal Computer，简称IPC），是上世纪90年代开始出现的、广泛应用于工业现场监视与控制的加固、增强型微型计算机，工控机常常会在环境比较恶劣的环境下运行，对数据的安全性要求也更高，所以工控机通常会进行加固、防尘、防潮、防腐蚀、防辐射等特别设计 截止到目前，X86+Windows（Wintel）架构，依然是工控机的主流方案，可被定义为传统工控机。一般而言

在传统工控机在工控领域的自动化和信息化方面发挥重要作用的同时，其先天弱势也一直困扰着厂家、集成商和用户。大家都在寻找更好的方案

近十年来，嵌入式系统发展迅速，以其具有的低功耗、低成本及不断提升的高性能等特点，已经成为移动设备（手机、PAD）的唯一方案；也成为包括工业控制在内的各行业实现数据采集处理的理想选择ARM架构的嵌入式系统，具有的灵活高效的软硬件方案定制特点，目前已经形成完整的产业链生态圈，能够为用户提供满足其现实需求、并有一定超前扩展余度的产品，且价格更有竞争优势的产品；当用户需求逐渐超出目前产品的能力时，又能够通过快速的方案设计与迭代，不断提供满足用户要求的新产品，能够实现“需求——技术——方案——产品——市场——用户——需求“不断上升的良性循环

相对于传统工控机，经特殊设计的基于嵌入式计算机架构的系统，被称为嵌入式工控机

传统工控机与嵌入式工控机的主要特点对比如下：

[options="header",cols="1,2,4,5"]
|====
|序号	|关键要素	|传统工控机（Windows+X86）	|嵌入式工控机（Linux+LoongArch/ARM）
|1	|性能	|商用级赛扬或商业/工业级酷睿i3~I5	|工业级，性能高于赛扬，弱于I3
|2	|安全性	|漏洞多，易受病毒和黑客攻击	|系统稳定、较少升级，安全性高
|3	|实时性	|实时响应能力较差	|实时响应能力能够满足要求
|4	|可靠性	|高功耗必须强散热，可靠性低	|低功耗无需考虑散热，可靠性高
|5	|扩展性	|在主板上扩展各类接口复杂	|在核心板/开发板上扩展各类接口较为方便
|6	|工业级	|实现真正工业级产品较为困难	|实现真正工业级产品较为容易
|7	|定制化	|定制化效率低、成本高	|面向应用快速高效订制与迭代
|8	|性能	|对工业应用而言性能不足或过剩	|针对应用，具有最佳性能方案
|9	|总体价格	|较高	|针对应用，具有价格优势
|10	|运维成本	|功耗高、运维成本高	|低功耗低成本，绿色环保
|11	|生命周期	|换代频繁，库存难以保证	|CPU生命周期较长，可保证库存
|====

嵌入式工控机已经成为传统工控机的强力竞争对手。在未来，前者形成对后者的压倒性优势，毫无悬念

== 嵌入式工控机的应用场景

工业互联网及物联网的迅速发展，既是一场众多的计算机软硬件厂家（也包括通讯方案和产品厂家，其本质也是计算机系统，甚至是嵌入式系统的软硬件厂家）尝试进入利润相对较高的行业监控市场的前赴后继的尝试；也是一场开启“民觉民智”，普及专业知识的启蒙运动。这个已经持续了十数年的大风暴，使普罗大众对监视和控制的应用需求和想象，扩展到了各行各业的每个角落

“云—管—边—端”的概念，是以互联网思维和术语，对监视控制原理做了经典的总结与归纳；但从技术发展历史看，它远非全新概念和新技术，实际上是数十年来各行业监控应用所采用的主流模式和架构


* 云：实现监控中心系统及更多高级应用软件和算法的计算机系统。这里的“云”，既包括互联网上的“公有云”，也包括企业局域网上的“私有云”。构建“云”的计算机系统，目前主要为高端X86+Windows/Linux服务器，及其集群
* 管：为设备两侧提供各种效率、可靠、便捷、高性价比的有线/无线通道。不仅在“云”和”边“之间有“管”的存在，例如广域以太网网、4G/5G等；在应用现场的“边”和“端”之间，也有适合现场应用场景的有线/无线的“管”的存在，比如局域以太网、串口、高速电力线载波（HPLC）、LoRa、ZigBee、WIFI等
* 边：用于完成现场计算任务的计算机系统。边”的主要角色，早期由传统工控机、或者在要求不那么严格时，用一般的台式机及服务器来承担；目前开始出现以中高端ARM架构嵌入式系统构建嵌入式工控机的趋势
* 端：用于实现对行业应用中对主设备（一次设备）进行监视和控制的装置（二次设备）、以及物联网环境中对各类主设备进行监控的设备（二次设备）。“端”的主要角色，早期由低端的嵌入式单片机系统实现；目前以逐渐过渡到以中低端嵌入式系统（主频1GMHz以下）为主流方案

从以上的分析不难看出，工控机的应用，主要定位在“边”的层面。作为“边”的具体应用，嵌入式工控机主要承载以下两种类型的功能：

* 自动运行类，如网关、NVR、路由器、防火墙等，通过特别设计的工业级中低档嵌入式计算机系统实现。部分具有简单的基于字符/位图的展示和特殊按键的参数配置和状态显示功能
* 交互运行类，完成监控和系统（含HMI人机交互界面）等功能，通过特别设计的工业级中高档嵌入式计算机系统实现，具有矢量化图形系统的交互能力

从以上的分析不难看出，工控机的应用，主要定位在“边”的层面。作为“边”的具体应用，嵌入式工控机主要承载以下两种类型的功能：

* 自动运行类，如网关、NVR、路由器、防火墙等，通过特别设计的工业级中低档嵌入式计算机系统实现。部分具有简单的基于字符/位图的展示和特殊按键的参数配置和状态显示功能
* 交互运行类，完成监控和系统（含HMI人机交互界面）等功能，通过特别设计的工业级中高档嵌入式计算机系统实现，具有矢量化图形系统的交互能力

嵌入式系统的CPU种类很多:

* ARM系列，国外的有：恩智浦（NXP）、高通（QUALCOMM）、德州仪器（TI）、三星（SAMSUNG）；国内的有：飞腾、全志、瑞星微、海思等
* 龙芯（LoongArch）系列，龙芯家族中的2系列，主要面向“边“及高级“端”的应用；1系列，主要面向中低级“端”的应用。

== 嵌入式工控机的典型应用场景

* 智能配电房、机房动力环境、泵站、智慧园区、智慧校园、智能制造等现场的边缘“大脑”，实现与现场数采单元、测控装置、保护设备、PLC设备、CNC设备、机器人设备的接入、协议解析、报警处理、转换、整合传输与控制
* 嵌入式SCADA系统（C/S、B/S模式）
* 100ms级别的软PLC
* 工控/物联网现场小型数据服务器
* 满足“智改数转”要求的企业车间级工业看板/OEE看板、轻量级MES前端数采和展示
* 基于行业应用的第三方算法、模型的开发与运行平台
* 视频前端设备的接入与推送、视频录像与联动、视频AI分析接口及分析结果的综合联动
* 现场网络安全及审计

= BPI-5202 龙芯2K1000LA嵌入式单板工控机

== BPI-5202 PCBA 硬件设计

BPI-5202作为单纯的嵌入式通用控制器软硬件开发平台，采用龙芯2K1000LA芯片设计，基本配置中有2个独立MAC以太网端口、2个RS485端口+1个RS232端口+2个CAN2.0端口，配置灵活，广泛适用于军工、电力、石油、厂矿、及物联网行业的自动化监控场合，为应用开发者提供功能齐全的硬件解决方案，并支持BSP+docker开发环境。提供较强算力的边缘计算支持。开发者可以快速利用开发平台，进行开发并产品化

=== PCBA 硬件接口

image::/indu-board/bpi-5020_en_int.jpg[bpi-5020_en_int.jpg]

=== PCBA 硬件规格

[cols="2,6"]
|====
| 处理器及OS	| 龙芯2K1000LAi 双核1.0GHz,Loongnix、LoongOS、LxAMP、麒麟V10
| 内存	| 4G DDR3，可配大容量SSD硬盘
| 基本通信功能	| 以太网口：2 x 1000M自适应，独立MAC,2 x RSRS485+1 x RS232+ 2 x CAN 2.0，带隔离,4G全网通
| 扩展功能模块	| 5个扩展槽位，以下模块任意组合,7 x RS485：带隔离（最多支持1个板卡扩展）;16 x DI：无源输入型，模块提供24V隔离电源;16 x DO：光耦继电器输出型，最大负载60V/500MA;8 x DI + 8 DO：继电器输出型，NC、COM、NO节点;8 x AI + 4 xAO：0-5V/4-
20mA;其它定制模块

| HMI接口	| HDMI
| USB	| USB支持键盘、鼠标；或电阻/电容显示屏接口
| 电源	| DC24V电源输入,24V隔离输出，IO板使用，500mA
                                                       
|==== 
         

=== 硬件扩展

为满足现场复杂的电气量接入需求，BPI-5202设计了5个可扩展IO槽位，每个IO槽位可根据需要配置为16xDI、16xDO、8xDI+8xDO、8xAI+4AO中的任意一种IO板卡，配合提供灵活多变的配置组合方式，并可以根据用户和项目的需求，定制各种功能板卡.

BPI-5202扩展口采用2.54mm 间距，2x10P 排针座，用来扩展IO接口。



BPI-5202支持模块化设计，提供丰富的扩展接口，可以采用基本单元 + 5个扩展单元，支持按需配置。扩展IO单元模块包括：

* 7 x RS485模块，带隔离
* 16 x DI模块（开关输入模块），无源输入（最多支持5个模块混插）
* 16 x DO模块(开关输出模块)，继电器输出（最多支持5个模块混插）
* 8 x DI+8 x DO O模块(开关输入/输出模块)，继电器输出（最多支持5个模块混插）
* 8 x AI + 4 x AO 模块（模拟量输入输出模块），支持0-5V、0-20mA输入
* 可根据需求定制Lora、ZigBee、433M无线传输模块、电力线载波模块、以及其它功能模块
* 支持第三方自行定制功能板卡，并与BPI-5202实现通信

所有电路板都通过内部总线(485或SPI)连接在盒子里

image::/indu-board/banana_pi_bpi-6202_gateway_5.jpg[banana_pi_bpi-6202_gateway_5.jpg]

Banana Pi BPI-5202 全功能扩展网关设计

image::/indu-board/banana_pi_bpi-6202_gateway_1.jpg[banana_pi_bpi-6202_gateway_1.jpg]

== BPI-5202 工业控制网关产品介绍

BI-5202嵌入式边缘计算工控机，是基于龙芯2K1000 (LA)研发的，同时连接数十台现场电气/物联网设备/视频前端设备的国产自主可控工控机。外部机箱及接口位置可根据现场工况灵活定制。BI-5202集成了以下功能:

* 300+工业通用/行业专用协议库
* 视频接入传输/控制/录像/联动功能
* 电气IO量采集控制功能（AI/AO/DI/DO）
* 边缘计算编程功能
* 工业防火墙功能
* PLC编程功能
* C/S架构SCADA系统功能
* B/S架构SCADA系统功能

BPI-5202 is based on the domestic autonomous controllable platform, and completely replaces the original on-site WinTel architecture industrial computer scheme in the autonomous controllable application of key technologies of automation systems and information systems in various industries.

Successfully passed the "2021 Domestic independent ecological industrial control system and product Test Evaluation" held by the "National Industrial Information Security Development Research Center" and the "National Industrial Control System Use Product Safety Quality Inspection and Testing Center" in 2021, and was recommended.

BPI-5202, the basic configuration has 2 independent IP Ethernet ports, 2 RS485 ports, 1 RS232 port, 2 CAN network ports, 4G/5G/WIFI, flexible configuration, widely used in power, oil, factories and mining, and the Internet of things industry automation monitoring occasions. It is the main homegrown autonomous controllable edge computing gateway in CS series.

BPI-5202 built-in 300+ protocol interpretation library and real-time database, can connect a variety of domestic and foreign protection devices, measurement and control devices, IEDs and other devices, and support IEC61850. Special specifications can be customized according to user requirements; Provide open API, convenient for users to develop their own protocol software, protocol software can be downloaded independently.

BPI-5202 can support the access of dozens of devices, data protocol analysis, conversion and unified transmission.

BPI-5202 has powerful video processing capabilities, including RTSP/RTMP video push-pull streaming, Onvif/GB28181 protocol stack and other video surveillance transmission functions, to achieve compatible access to multi-manufacturer video front-end equipment (IPC, NVR), after configuring a large capacity hard disk can replace NVR, video recording and playback functions. Provides the industry's only data + video perfect integration solution.

The BPI-5202 supports full SCADA system functions up to 2048 points via HDMI display interface and USB keyboard and mouse (or touch screen).

BPI-5202 supports three configuration modes:

* Built-in WEB management, query/configure the working parameters of the device through the browser
* Dedicated configuration software configures device parameters
* Cloud remote management, gateway to gateway configuration and diagnosis, firmware and application upgrades

BPI-5202 adopts the original iCoupler® digital isolation technology, RS485 automatic direction control, RS485 zero delay transmission technology, fully considering the particularness of industrial field applications in design, following EMI/EMC design specifications, and adapting to various harsh industrial sites and iot sites. Ensure the reliability of communication and various IO semaphore.

The appearance of the BPI-5202 including the chassis is shown in the figure below.

image::/indu-board/industrial_computer_zh_3.png[industrial_computer_zh_3.png]

=== BPI-5202 interface description

image::/indu-board/bpi_industrial_product_interface_6.png[bpi_industrial_product_interface_6.png]

[options="header",cols="1,1,6"]
|====
| No | interface     | illustrate                                                                                                                                                                                  
| 1  | HDMI 1.4   | HDMI video cable to connect the video output port and the monitor. +
**Note**: The HDMI video cable is not included in the installation accessory package and needs to be purchased by the user. Please choose a shielded cable with a length less than 3M 
| 2  | USB 2.0             | Use the USB interface to connect the keyboard/mouse/touch screen, and connect the U disk. +
**Note**: The USB interface does not support hot swapping of storage devices.                                                                                  
| 3  | Ethernet port       | Use a network cable to connect the Ethernet port of the device to the switch, supporting 1 x 1000M + 1 x 100M                                                                                                                                        
| 4  | RS232/RS485         | Phoenix terminal, RS232 x 1+ RS485 x 2, connect the cable terminal to the Phoenix terminal interface of CS6202, and make sure that the peer device and BPI-6202 are connected to the ground wire.                                                    
| 5  | DC power            | Phoenix terminal, using 24V DC power supply                                                                                                                                                                                                          
| 6  | WiFi Antenna Mount  | SMA-K (external thread + internal hole), if you need to use the antenna to connect to the network, connect the antenna device to the BPI-6202 through the antenna interface. Standard 1 antenna, Wifi antenna, 4G+WiFi;                              
| 7  | 4G/5G Antenna Mount | A standard 4G antenna is provided. If you need to expand 5G, you need to use a customized chassis and configure 4 additional antennas                                                                                                                
| 8  | 3 indicator lights  | From top to bottom, they are: system running light, which flashes regularly during normal operation; reserved light (programmable and controllable); 4G/5G running light, showing cellular communication status                                      
|====

=== BPI-5202 product key feature

=== Internal logical structure

image::/indu-board/bpi-5020_1.png[bpi-5020_1.png]

=== External connection

image::/indu-board/industrial_computer_zh_6.png[industrial_computer_zh_6.png]


= Cooperation method
. BPI-5206 is an open-source hardware product. The Banana Pi community provides all BSP board-level support codes and supports Docker containers in the codes. Customers with technical development capabilities can directly carry out secondary application development on BPI-6202.
. BPI-5202 as a basic platform for secondary development, it provides various development tools and protocol analysis database interfaces for application developers, greatly shortening the development week of various industry application products and reducing the difficulty of development.
. BPI-5202 is a complete industrial control product, customers can directly use it for industrial control and provide complete product-level support.